# 草野球 is Good - 完全版権限マトリックス

最終更新: 2025-08-25

## 凡例
- ✅ : 可能
- ❌ : 不可
- 🔒 : 条件付き（条件を脚注に記載）
- － : 該当なし

## ユーザー種別の定義

| ユーザー種別 | 説明 |
|------------|------|
| **未ログイン** | アカウントを作成していない、またはログインしていない閲覧者 |
| **ログイン済み（非メンバー）** | ログインしているが、どのチームにも所属していないユーザー |
| **チームメンバー** | 特定チームに承認されて所属しているユーザー |
| **チーム管理者** | チームを作成した、または管理者権限を持つユーザー |
| **試合作成者** | 特定の試合を作成したユーザー |

---

## 1. 認証・プロフィール管理

| 機能 | 詳細 | 未ログイン | ログイン済み（非メンバー） | チームメンバー | チーム管理者 | 試合作成者 |
|------|------|------------|------------------------|--------------|------------|----------|
| **user_profiles** |
| | プロフィール閲覧 | ✅ | ✅ | ✅ | ✅ | ✅ |
| | プロフィール作成 | ❌ | ✅¹ | ✅¹ | ✅¹ | ✅¹ |
| | プロフィール編集 | ❌ | 🔒¹ | 🔒¹ | 🔒¹ | 🔒¹ |

**注釈:**
- **¹** 自分のプロフィールのみ作成・編集可能

---

## 2. チーム管理

| 機能 | 詳細 | 未ログイン | ログイン済み（非メンバー） | チームメンバー | チーム管理者 | 試合作成者 |
|------|------|------------|------------------------|--------------|------------|----------|
| **teams** |
| | チーム一覧閲覧 | ✅ | ✅ | ✅ | ✅ | ✅ |
| | チーム詳細閲覧 | ✅ | ✅ | ✅ | ✅ | ✅ |
| | チーム作成 | ❌ | ✅ | ✅ | ✅ | ✅ |
| | チーム情報編集 | ❌ | ❌ | ❌ | ✅² | ❌ |
| | チーム削除 | ❌ | ❌ | ❌ | ✅² | ❌ |

**注釈:**
- **²** 自分が所有するチームのみ編集・削除可能

---

## 3. チームメンバー管理

| 機能 | 詳細 | 未ログイン | ログイン済み（非メンバー） | チームメンバー | チーム管理者 | 試合作成者 |
|------|------|------------|------------------------|--------------|------------|----------|
| **team_members** |
| | メンバー一覧閲覧 | ✅ | ✅ | ✅ | ✅ | ✅ |
| | メンバー追加 | ❌ | ❌ | ❌ | ✅³ | ❌ |
| | チーム脱退（自分） | ❌ | ❌ | ✅⁴ | ✅⁴ | － |

**注釈:**
- **³** チーム管理者のみメンバー追加可能（参加申請承認を通じて）
- **⁴** 自分自身のみチーム脱退可能

---

## 4. チーム参加申請

| 機能 | 詳細 | 未ログイン | ログイン済み（非メンバー） | チームメンバー | チーム管理者 | 試合作成者 |
|------|------|------------|------------------------|--------------|------------|----------|
| **team_join_requests** |
| | 参加申請送信 | ❌ | ✅ | ✅ | ✅ | ✅ |
| | 自分の申請閲覧 | ❌ | ✅⁵ | ✅⁵ | ✅⁵ | ✅⁵ |
| | チームへの申請閲覧 | ❌ | ❌ | ❌ | ✅⁶ | ❌ |
| | 申請承認・却下 | ❌ | ❌ | ❌ | ✅⁶ | ❌ |
| | 申請取り消し（pending状態） | ❌ | ✅⁵ | ✅⁵ | ✅⁵ | ✅⁵ |

**注釈:**
- **⁵** 自分の申請のみ閲覧・取り消し可能
- **⁶** 自分が管理するチームへの申請のみ閲覧・承認可能

---

## 5. デフォルトラインナップ管理

| 機能 | 詳細 | 未ログイン | ログイン済み（非メンバー） | チームメンバー | チーム管理者 | 試合作成者 |
|------|------|------------|------------------------|--------------|------------|----------|
| **team_default_lineup** |
| | ラインナップ閲覧 | ❌ | ❌ | ✅⁷ | ✅⁷ | ❌ |
| | ラインナップ作成・編集 | ❌ | ❌ | ✅⁷ | ✅⁷ | ❌ |
| | ラインナップ削除 | ❌ | ❌ | ✅⁷ | ✅⁷ | ❌ |

**注釈:**
- **⁷** 所属チームのデフォルトラインナップのみ管理可能

---

## 6. 試合管理（基本）

| 機能 | 詳細 | 未ログイン | ログイン済み（非メンバー） | チームメンバー | チーム管理者 | 試合作成者 |
|------|------|------------|------------------------|--------------|------------|----------|
| **games** |
| | 公開試合閲覧 | ✅⁸ | ✅ | ✅ | ✅ | ✅ |
| | 非公開試合閲覧 | ❌ | 🔒⁹ | ✅ | ✅ | ✅ |
| | 試合作成 | ❌ | ✅ | ✅ | ✅ | ✅ |
| | 試合編集 | ❌ | 🔒¹⁰ | ✅¹¹ | ✅¹¹ | ✅¹⁰ |
| | 試合削除 | ❌ | 🔒¹⁰ | ❌ | ❌ | ✅¹⁰ |

**注釈:**
- **⁸** 公開設定（is_public = true）の試合のみ閲覧可能
- **⁹** 自分が作成した試合のみ閲覧可能
- **¹⁰** 自分が作成した試合のみ編集・削除可能
- **¹¹** 所属チームの試合を編集可能

---

## 7. スコア管理

| 機能 | 詳細 | 未ログイン | ログイン済み（非メンバー） | チームメンバー | チーム管理者 | 試合作成者 |
|------|------|------------|------------------------|--------------|------------|----------|
| **game_scores** |
| | スコア閲覧 | ✅ | ✅ | ✅ | ✅ | ✅ |
| | スコア入力・編集 | ❌ | ❌ | ✅¹² | ✅¹² | ✅ |
| | スコア削除 | ❌ | ❌ | ✅¹² | ✅¹² | ✅ |

**注釈:**
- **¹²** 所属チームの試合、または自分が作成した試合のスコア管理可能

---

## 8. 選手管理

| 機能 | 詳細 | 未ログイン | ログイン済み（非メンバー） | チームメンバー | チーム管理者 | 試合作成者 |
|------|------|------------|------------------------|--------------|------------|----------|
| **game_players** |
| | 選手一覧閲覧 | ✅ | ✅ | ✅ | ✅ | ✅ |
| | 選手登録・編集 | ❌ | ❌ | ✅¹³ | ✅¹³ | ✅ |
| | 選手削除 | ❌ | ❌ | ✅¹³ | ✅¹³ | ✅ |

**注釈:**
- **¹³** 試合作成者、チーム管理者、チームメンバーが管理可能

---

## 9. 打撃成績管理

| 機能 | 詳細 | 未ログイン | ログイン済み（非メンバー） | チームメンバー | チーム管理者 | 試合作成者 |
|------|------|------------|------------------------|--------------|------------|----------|
| **game_batting_records** |
| | 打撃成績閲覧 | ✅ | ✅ | ✅ | ✅ | ✅ |
| | 打撃成績入力 | ❌ | ❌ | ✅¹³ | ✅¹³ | ✅ |
| | 打撃成績編集 | ❌ | ❌ | ✅¹³ | ✅¹³ | ✅ |
| | 打撃成績削除 | ❌ | ❌ | ✅¹³ | ✅¹³ | ✅ |

**注釈:**
- **¹³** 試合作成者、チーム管理者、チームメンバーが管理可能

---

## 10. 投手成績管理

| 機能 | 詳細 | 未ログイン | ログイン済み（非メンバー） | チームメンバー | チーム管理者 | 試合作成者 |
|------|------|------------|------------------------|--------------|------------|----------|
| **game_pitching_records** |
| | 投手成績閲覧 | ✅ | ✅ | ✅ | ✅ | ✅ |
| | 投手成績入力 | ❌ | ❌ | ✅¹³ | ✅¹³ | ✅ |
| | 投手成績編集 | ❌ | ❌ | ✅¹³ | ✅¹³ | ✅ |
| | 投手成績削除 | ❌ | ❌ | ✅¹³ | ✅¹³ | ✅ |

**注釈:**
- **¹³** 試合作成者、チーム管理者、チームメンバーが管理可能

---

## 11. ランナー管理

| 機能 | 詳細 | 未ログイン | ログイン済み（非メンバー） | チームメンバー | チーム管理者 | 試合作成者 |
|------|------|------------|------------------------|--------------|------------|----------|
| **game_runners** |
| | ランナー状況閲覧 | ✅ | ✅ | ✅ | ✅ | ✅ |
| | ランナー記録・編集 | ❌ | ❌ | ✅¹⁴ | ✅¹⁴ | ❌ |
| | ランナー削除 | ❌ | ❌ | ✅¹⁴ | ✅¹⁴ | ❌ |

**注釈:**
- **¹⁴** 所属チームの試合のランナー管理可能

---

## 12. 選手交代管理

| 機能 | 詳細 | 未ログイン | ログイン済み（非メンバー） | チームメンバー | チーム管理者 | 試合作成者 |
|------|------|------------|------------------------|--------------|------------|----------|
| **game_substitutions** |
| | 交代記録閲覧 | ✅ | ✅ | ✅ | ✅ | ✅ |
| | 交代記録作成 | ❌ | ❌ | ✅¹³ | ✅¹³ | ✅ |
| | 交代記録編集 | ❌ | ❌ | ✅¹³ | ✅¹³ | ✅ |
| | 交代記録削除 | ❌ | ❌ | ✅¹³ | ✅¹³ | ✅ |

**注釈:**
- **¹³** 試合作成者、チーム管理者、チームメンバーが管理可能

---

## 13. 出欠管理

| 機能 | 詳細 | 未ログイン | ログイン済み（非メンバー） | チームメンバー | チーム管理者 | 試合作成者 |
|------|------|------------|------------------------|--------------|------------|----------|
| **game_attendances** |
| | 出欠状況閲覧 | ❌ | ❌ | ✅¹⁵ | ✅¹⁵ | ❌ |
| | 出欠レコード作成 | ❌ | ❌ | ✅¹⁶ | ✅¹⁶ | ❌ |
| | 自分の出欠回答 | ❌ | ❌ | ✅¹⁷ | ✅¹⁷ | ❌ |
| | ゲスト追加 | ❌ | ❌ | ✅¹⁶ | ✅¹⁶ | ❌ |

**注釈:**
- **¹⁵** 所属チームの試合の出欠確認可能
- **¹⁶** 所属チームの試合で出欠レコード作成可能
- **¹⁷** 自分の出欠のみ回答可能

---

## 14. 運営タスク管理

| 機能 | 詳細 | 未ログイン | ログイン済み（非メンバー） | チームメンバー | チーム管理者 | 試合作成者 |
|------|------|------------|------------------------|--------------|------------|----------|
| **game_operation_tasks** |
| | タスク一覧閲覧 | ✅ | ✅ | ✅ | ✅ | ✅ |
| | タスク登録 | ❌ | ❌ | ✅¹⁸ | ✅¹⁸ | ❌ |
| | タスク編集 | ❌ | ❌ | ✅¹⁸ | ✅¹⁸ | ❌ |
| | タスク削除 | ❌ | ❌ | ✅¹⁸ | ✅¹⁸ | ❌ |

**注釈:**
- **¹⁸** 所属チームの試合の運営タスク管理可能

---

## 重要な権限ルール

### 基本原則
1. **閲覧権限は緩く**：多くのデータは誰でも閲覧可能（成績、公開試合など）
2. **編集権限は厳しく**：データの編集は関係者のみに限定
3. **削除権限は最も厳しく**：削除は作成者や管理者のみ

### 特殊ケース
- **試合作成者権限**：試合を作成した人は、チームメンバーでなくても自分の試合を完全に管理可能
- **チーム管理者権限**：チームに関するすべての操作が可能
- **出欠管理**：チームメンバーのみアクセス可能な限定機能
- **公開/非公開の区別**：試合には公開設定があり、非公開試合は関係者のみ閲覧可能

### セキュリティ考慮事項
- すべての削除操作は作成者または管理者に限定
- 個人情報（出欠など）はチーム内のみで共有
- チーム参加は申請・承認制で管理